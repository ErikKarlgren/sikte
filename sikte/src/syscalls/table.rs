/// Maximum number of syscall ids
const MAX_NUM_SYSCALLS: usize = 1024;

/// Syscall table. Maps syscall IDs to their name.
const SYSCALL_TABLE: [&str; MAX_NUM_SYSCALLS] = build_syscall_table();

/// Convert a syscall id extracted from an eBPF program to its name
pub const fn to_syscall_name(syscall_id: i64) -> Option<&'static str> {
    if syscall_id as usize > SYSCALL_TABLE.len() || syscall_id < 0 {
        return None;
    }
    let name = SYSCALL_TABLE[syscall_id as usize];
    if name.is_empty() {
        return Some("???");
    }
    Some(name)
}

#[cfg(target_arch = "x86_64")]
const fn build_syscall_table() -> [&'static str; MAX_NUM_SYSCALLS] {
    // Data extracted from: https://github.com/torvalds/linux/blob/v6.16-rc1/arch/x86/entry/syscalls/syscall_64.tbl
    let mut t: [&str; MAX_NUM_SYSCALLS] = [""; MAX_NUM_SYSCALLS];

    t[0] = "read";
    t[1] = "write";
    t[2] = "open";
    t[3] = "close";
    t[4] = "stat";
    t[5] = "fstat";
    t[6] = "lstat";
    t[7] = "poll";
    t[8] = "lseek";
    t[9] = "mmap";
    t[10] = "mprotect";
    t[11] = "munmap";
    t[12] = "brk";
    t[13] = "rt_sigaction (64)";
    t[14] = "rt_sigprocmask";
    t[15] = "rt_sigreturn (64)";
    t[16] = "ioctl (64)";
    t[17] = "pread64";
    t[18] = "pwrite64";
    t[19] = "readv (64)";
    t[20] = "writev (64)";
    t[21] = "access";
    t[22] = "pipe";
    t[23] = "select";
    t[24] = "sched_yield";
    t[25] = "mremap";
    t[26] = "msync";
    t[27] = "mincore";
    t[28] = "madvise";
    t[29] = "shmget";
    t[30] = "shmat";
    t[31] = "shmctl";
    t[32] = "dup";
    t[33] = "dup2";
    t[34] = "pause";
    t[35] = "nanosleep";
    t[36] = "getitimer";
    t[37] = "alarm";
    t[38] = "setitimer";
    t[39] = "getpid";
    t[40] = "sendfile";
    t[41] = "socket";
    t[42] = "connect";
    t[43] = "accept";
    t[44] = "sendto";
    t[45] = "recvfrom (64)";
    t[46] = "sendmsg (64)";
    t[47] = "recvmsg (64)";
    t[48] = "shutdown";
    t[49] = "bind";
    t[50] = "listen";
    t[51] = "getsockname";
    t[52] = "getpeername";
    t[53] = "socketpair";
    t[54] = "setsockopt (64)";
    t[55] = "getsockopt (64)";
    t[56] = "clone";
    t[57] = "fork";
    t[58] = "vfork";
    t[59] = "execve (64)";
    t[60] = "exit";
    t[61] = "wait4";
    t[62] = "kill";
    t[63] = "uname";
    t[64] = "semget";
    t[65] = "semop";
    t[66] = "semctl";
    t[67] = "shmdt";
    t[68] = "msgget";
    t[69] = "msgsnd";
    t[70] = "msgrcv";
    t[71] = "msgctl";
    t[72] = "fcntl";
    t[73] = "flock";
    t[74] = "fsync";
    t[75] = "fdatasync";
    t[76] = "truncate";
    t[77] = "ftruncate";
    t[78] = "getdents";
    t[79] = "getcwd";
    t[80] = "chdir";
    t[81] = "fchdir";
    t[82] = "rename";
    t[83] = "mkdir";
    t[84] = "rmdir";
    t[85] = "creat";
    t[86] = "link";
    t[87] = "unlink";
    t[88] = "symlink";
    t[89] = "readlink";
    t[90] = "chmod";
    t[91] = "fchmod";
    t[92] = "chown";
    t[93] = "fchown";
    t[94] = "lchown";
    t[95] = "umask";
    t[96] = "gettimeofday";
    t[97] = "getrlimit";
    t[98] = "getrusage";
    t[99] = "sysinfo";
    t[100] = "times";
    t[101] = "ptrace (64)";
    t[102] = "getuid";
    t[103] = "syslog";
    t[104] = "getgid";
    t[105] = "setuid";
    t[106] = "setgid";
    t[107] = "geteuid";
    t[108] = "getegid";
    t[109] = "setpgid";
    t[110] = "getppid";
    t[111] = "getpgrp";
    t[112] = "setsid";
    t[113] = "setreuid";
    t[114] = "setregid";
    t[115] = "getgroups";
    t[116] = "setgroups";
    t[117] = "setresuid";
    t[118] = "getresuid";
    t[119] = "setresgid";
    t[120] = "getresgid";
    t[121] = "getpgid";
    t[122] = "setfsuid";
    t[123] = "setfsgid";
    t[124] = "getsid";
    t[125] = "capget";
    t[126] = "capset";
    t[127] = "rt_sigpending (64)";
    t[128] = "rt_sigtimedwait (64)";
    t[129] = "rt_sigqueueinfo (64)";
    t[130] = "rt_sigsuspend";
    t[131] = "sigaltstack (64)";
    t[132] = "utime";
    t[133] = "mknod";
    t[134] = "uselib (64)";
    t[135] = "personality";
    t[136] = "ustat";
    t[137] = "statfs";
    t[138] = "fstatfs";
    t[139] = "sysfs";
    t[140] = "getpriority";
    t[141] = "setpriority";
    t[142] = "sched_setparam";
    t[143] = "sched_getparam";
    t[144] = "sched_setscheduler";
    t[145] = "sched_getscheduler";
    t[146] = "sched_get_priority_max";
    t[147] = "sched_get_priority_min";
    t[148] = "sched_rr_get_interval";
    t[149] = "mlock";
    t[150] = "munlock";
    t[151] = "mlockall";
    t[152] = "munlockall";
    t[153] = "vhangup";
    t[154] = "modify_ldt";
    t[155] = "pivot_root";
    t[156] = "_sysctl (64)";
    t[157] = "prctl";
    t[158] = "arch_prctl";
    t[159] = "adjtimex";
    t[160] = "setrlimit";
    t[161] = "chroot";
    t[162] = "sync";
    t[163] = "acct";
    t[164] = "settimeofday";
    t[165] = "mount";
    t[166] = "umount2";
    t[167] = "swapon";
    t[168] = "swapoff";
    t[169] = "reboot";
    t[170] = "sethostname";
    t[171] = "setdomainname";
    t[172] = "iopl";
    t[173] = "ioperm";
    t[174] = "create_module (64)";
    t[175] = "init_module";
    t[176] = "delete_module";
    t[177] = "get_kernel_syms (64)";
    t[178] = "query_module (64)";
    t[179] = "quotactl";
    t[180] = "nfsservctl (64)";
    t[181] = "getpmsg";
    t[182] = "putpmsg";
    t[183] = "afs_syscall";
    t[184] = "tuxcall";
    t[185] = "security";
    t[186] = "gettid";
    t[187] = "readahead";
    t[188] = "setxattr";
    t[189] = "lsetxattr";
    t[190] = "fsetxattr";
    t[191] = "getxattr";
    t[192] = "lgetxattr";
    t[193] = "fgetxattr";
    t[194] = "listxattr";
    t[195] = "llistxattr";
    t[196] = "flistxattr";
    t[197] = "removexattr";
    t[198] = "lremovexattr";
    t[199] = "fremovexattr";
    t[200] = "tkill";
    t[201] = "time";
    t[202] = "futex";
    t[203] = "sched_setaffinity";
    t[204] = "sched_getaffinity";
    t[205] = "set_thread_area (64)";
    t[206] = "io_setup (64)";
    t[207] = "io_destroy";
    t[208] = "io_getevents";
    t[209] = "io_submit (64)";
    t[210] = "io_cancel";
    t[211] = "get_thread_area (64)";
    t[212] = "lookup_dcookie";
    t[213] = "epoll_create";
    t[214] = "epoll_ctl_old (64)";
    t[215] = "epoll_wait_old (64)";
    t[216] = "remap_file_pages";
    t[217] = "getdents64";
    t[218] = "set_tid_address";
    t[219] = "restart_syscall";
    t[220] = "semtimedop";
    t[221] = "fadvise64";
    t[222] = "timer_create (64)";
    t[223] = "timer_settime";
    t[224] = "timer_gettime";
    t[225] = "timer_getoverrun";
    t[226] = "timer_delete";
    t[227] = "clock_settime";
    t[228] = "clock_gettime";
    t[229] = "clock_getres";
    t[230] = "clock_nanosleep";
    t[231] = "exit_group";
    t[232] = "epoll_wait";
    t[233] = "epoll_ctl";
    t[234] = "tgkill";
    t[235] = "utimes";
    t[236] = "vserver (64)";
    t[237] = "mbind";
    t[238] = "set_mempolicy";
    t[239] = "get_mempolicy";
    t[240] = "mq_open";
    t[241] = "mq_unlink";
    t[242] = "mq_timedsend";
    t[243] = "mq_timedreceive";
    t[244] = "mq_notify (64)";
    t[245] = "mq_getsetattr";
    t[246] = "kexec_load (64)";
    t[247] = "waitid (64)";
    t[248] = "add_key";
    t[249] = "request_key";
    t[250] = "keyctl";
    t[251] = "ioprio_set";
    t[252] = "ioprio_get";
    t[253] = "inotify_init";
    t[254] = "inotify_add_watch";
    t[255] = "inotify_rm_watch";
    t[256] = "migrate_pages";
    t[257] = "openat";
    t[258] = "mkdirat";
    t[259] = "mknodat";
    t[260] = "fchownat";
    t[261] = "futimesat";
    t[262] = "newfstatat";
    t[263] = "unlinkat";
    t[264] = "renameat";
    t[265] = "linkat";
    t[266] = "symlinkat";
    t[267] = "readlinkat";
    t[268] = "fchmodat";
    t[269] = "faccessat";
    t[270] = "pselect6";
    t[271] = "ppoll";
    t[272] = "unshare";
    t[273] = "set_robust_list (64)";
    t[274] = "get_robust_list (64)";
    t[275] = "splice";
    t[276] = "tee";
    t[277] = "sync_file_range";
    t[278] = "vmsplice (64)";
    t[279] = "move_pages (64)";
    t[280] = "utimensat";
    t[281] = "epoll_pwait";
    t[282] = "signalfd";
    t[283] = "timerfd_create";
    t[284] = "eventfd";
    t[285] = "fallocate";
    t[286] = "timerfd_settime";
    t[287] = "timerfd_gettime";
    t[288] = "accept4";
    t[289] = "signalfd4";
    t[290] = "eventfd2";
    t[291] = "epoll_create1";
    t[292] = "dup3";
    t[293] = "pipe2";
    t[294] = "inotify_init1";
    t[295] = "preadv (64)";
    t[296] = "pwritev (64)";
    t[297] = "rt_tgsigqueueinfo (64)";
    t[298] = "perf_event_open";
    t[299] = "recvmmsg (64)";
    t[300] = "fanotify_init";
    t[301] = "fanotify_mark";
    t[302] = "prlimit64";
    t[303] = "name_to_handle_at";
    t[304] = "open_by_handle_at";
    t[305] = "clock_adjtime";
    t[306] = "syncfs";
    t[307] = "sendmmsg (64)";
    t[308] = "setns";
    t[309] = "getcpu";
    t[310] = "process_vm_readv (64)";
    t[311] = "process_vm_writev (64)";
    t[312] = "kcmp";
    t[313] = "finit_module";
    t[314] = "sched_setattr";
    t[315] = "sched_getattr";
    t[316] = "renameat2";
    t[317] = "seccomp";
    t[318] = "getrandom";
    t[319] = "memfd_create";
    t[320] = "kexec_file_load";
    t[321] = "bpf";
    t[322] = "execveat (64)";
    t[323] = "userfaultfd";
    t[324] = "membarrier";
    t[325] = "mlock2";
    t[326] = "copy_file_range";
    t[327] = "preadv2 (64)";
    t[328] = "pwritev2 (64)";
    t[329] = "pkey_mprotect";
    t[330] = "pkey_alloc";
    t[331] = "pkey_free";
    t[332] = "statx";
    t[333] = "io_pgetevents";
    t[334] = "rseq";
    t[335] = "uretprobe";
    t[424] = "pidfd_send_signal";
    t[425] = "io_uring_setup";
    t[426] = "io_uring_enter";
    t[427] = "io_uring_register";
    t[428] = "open_tree";
    t[429] = "move_mount";
    t[430] = "fsopen";
    t[431] = "fsconfig";
    t[432] = "fsmount";
    t[433] = "fspick";
    t[434] = "pidfd_open";
    t[435] = "clone3";
    t[436] = "close_range";
    t[437] = "openat2";
    t[438] = "pidfd_getfd";
    t[439] = "faccessat2";
    t[440] = "process_madvise";
    t[441] = "epoll_pwait2";
    t[442] = "mount_setattr";
    t[443] = "quotactl_fd";
    t[444] = "landlock_create_ruleset";
    t[445] = "landlock_add_rule";
    t[446] = "landlock_restrict_self";
    t[447] = "memfd_secret";
    t[448] = "process_mrelease";
    t[449] = "futex_waitv";
    t[450] = "set_mempolicy_home_node";
    t[451] = "cachestat";
    t[452] = "fchmodat2";
    t[453] = "map_shadow_stack";
    t[454] = "futex_wake";
    t[455] = "futex_wait";
    t[456] = "futex_requeue";
    t[457] = "statmount";
    t[458] = "listmount";
    t[459] = "lsm_get_self_attr";
    t[460] = "lsm_set_self_attr";
    t[461] = "lsm_list_modules";
    t[462] = "mseal";
    t[463] = "setxattrat";
    t[464] = "getxattrat";
    t[465] = "listxattrat";
    t[466] = "removexattrat";
    t[467] = "open_tree_attr";

    // Syscalls for x32
    t[512] = "rt_sigaction (x32)";
    t[513] = "rt_sigreturn (x32)";
    t[514] = "ioctl (x32)";
    t[515] = "readv (x32)";
    t[516] = "writev (x32)";
    t[517] = "recvfrom (x32)";
    t[518] = "sendmsg (x32)";
    t[519] = "recvmsg (x32)";
    t[520] = "execve (x32)";
    t[521] = "ptrace (x32)";
    t[522] = "rt_sigpending (x32)";
    t[523] = "rt_sigtimedwait (x32)";
    t[524] = "rt_sigqueueinfo (x32)";
    t[525] = "sigaltstack (x32)";
    t[526] = "timer_create (x32)";
    t[527] = "mq_notify (x32)";
    t[528] = "kexec_load (x32)";
    t[529] = "waitid (x32)";
    t[530] = "set_robust_list (x32)";
    t[531] = "get_robust_list (x32)";
    t[532] = "vmsplice (x32)";
    t[533] = "move_pages (x32)";
    t[534] = "preadv (x32)";
    t[535] = "pwritev (x32)";
    t[536] = "rt_tgsigqueueinfo (x32)";
    t[537] = "recvmmsg (x32)";
    t[538] = "sendmmsg (x32)";
    t[539] = "process_vm_readv (x32)";
    t[540] = "process_vm_writev (x32)";
    t[541] = "setsockopt (x32)";
    t[542] = "getsockopt (x32)";
    t[543] = "io_setup (x32)";
    t[544] = "io_submit (x32)";
    t[545] = "execveat (x32)";
    t[546] = "preadv2 (x32)";
    t[547] = "pwritev2 (x32)";

    return t;
}

#[cfg(not(target_arch = "x86_64"))]
const fn build_syscall_table() -> [&'static str; MAX_NUM_SYSCALLS] {
    compile_error!("non supported architecture");
}
